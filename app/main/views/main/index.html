<:Title>
  Home
 
<:Body>
  {{ if Volt.user }}
  <h2>Conversations</h2>
    <div class="col-md-4">
      <div class="scrollable-list">
        {{ my_conversations.each do |conversation| }}
          {{ if conversation._sender_id == Volt.user._id }}
            <div class="contact {{ if params._user_id == conversation._receiver_id && params._opinion_id == conversation._opinion_id }} active {{ end }}" e-click="select_conversation(conversation._receiver_id, conversation._opinion_id)">
              {{ _opinions.find_one(_id: conversation._opinion_id)._name }}
            </div>
          {{ else }}
            <div class="contact {{ if params._user_id == conversation._sender_id && params._opinion_id == conversation._opinion_id }} active {{ end }}" e-click="select_conversation(conversation._sender_id, conversation._opinion_id)">
              {{ _opinions.find_one(_id: conversation._opinion_id)._name }}
            </div>
          {{ end }}
        {{ end }}
      </div>
  <h2>Beliefs</h2>
      <div class="row">
        <div class="scrollable-list">
          {{ other_opinions.each do |opinion| }}
            {{ if _conversations.find({ "$or" => [{ sender_id: Volt.user._id, opinion_id: opinion._id }, { receiver_id: Volt.user._id, opinion_id: opinion._id }] }).count == 0 }}
              <div>
                {{ _users.find( _id: opinion._user_id).each do |user| }}
                  <div class="contact" e-click="add_conversation(user, opinion)">
                    {{opinion._name}}
                  </div>
                {{ end }}
              </div>
            {{ end }}
          {{ end }}
        </div>
      </div>
    </div>
      {{ if params._user_id }}
        <div class="col-md-8 well conversation">
          {{ current_conversation.each do |message| }}
            <div class="message {{ if message._sender_id == Volt.user._id }} sent {{ end }}">
              <p>{{ message._text }}</p>
            </div>
          {{ end }}
 
          {{ if current_conversation.count == 0 }}
            <p>You have no messages yet. Start chatting!</p>
          {{ else }}
            <div class="clearfix"></div>
          {{ end }}
 
          {{ if Volt.user._is_speaker == true }}
            <form e-submit="send_message" role="form">
              <div class="form-group">
                <input class="form-control" type="text" placeholder="Please try to express your opinion clearly" value="{{ page._new_message }}" />
                <button type="submit" class="btn btn-primary pull-right">Send</button>
              </div>
            </form>
            {{ _users.each do |user| }}
              {{ if user._id == params._user_id }}
                {{ if user._go_ahead == false }}
                  <button type="button" e-click="go_ahead(user)" class="btn btn-warning">Go ahead</button>
                {{ else }}
                  <button type="button" e-click="not_quite(user)" class="btn btn-danger">Not quite</button>
                {{ end }}
                <button type="button" e-click="i_feel_understood(user)" class="btn btn-success">I feel understood!</button>
              {{ end }}
            {{ end }}
          {{ else }}
            {{ _users.each do |user| }}
              {{ if user._id == params._user_id }}
                {{ if Volt.user._go_ahead == true }}
                  <form e-submit="send_message" role="form">
                    <div class="form-group">
                      <input class="form-control" type="text" placeholder="Please try to express what they are saying in your own words" value="{{ page._new_message }}" />
                      <button type="submit" class="btn btn-primary pull-right">Send</button>
                    </div>
                  </form>
                {{ else }}
                  <button type="button" e-click="i_think_i_understand(user)" class="btn btn-warning">I think I understand</button>
                {{ end }}
              {{ end }}
            {{ end }}
          {{ end }}
        </div>
      {{ end }}
    </div>
  {{ else }}
    <p>This is a chat application built with Volt to demonstrate its real-time capabilities. Please log in to access it.</p>
  {{ end }}
